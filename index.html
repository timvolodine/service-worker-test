<!DOCTYPE html>
<html>
  <head>
    <title>WebView Service Worker experimentation</title>
  </head>
  <body>
    <table>
      <tr>
        <td>hartbeat:</td>
        <td width="250px" id="hartbeat"></td>
      </tr>
    </table>
    
    <button type="button" onclick="register()">register</button>
    <button type="button" onclick="manualFetch()">fetch</button>
    <button type="button" onclick="startWorker()">start worker</button>
<p></p>
<table id="logTable">
</table>

    <script type="text/javascript">
      var beat="";
      function hartbeat() {
        beat=beat+".";
        if (beat==="....") beat="";
        document.getElementById("hartbeat").innerHTML = beat;
        setTimeout(hartbeat, 2000);
      }
      
      hartbeat();
      
      function logToHtml(message) {
          var table = document.getElementById("logTable");
          var row = table.insertRow(-1);
          var cell = row.insertCell();
          cell.innerHTML = message;
      }

      function register() {
        navigator.serviceWorker.register('sw.js').then(function(registration) {
          console.log('ServiceWorker registration successful with scope: ', registration.scope);
          logToHtml('ServiceWorker registration success with scope ' + registration.scope);
        }).catch(function(err) {
          console.log('ServiceWorker registration failed: ', err);
          logToHtml('registration failed: ' + err);
        });
      }
      
      function manualFetch() {
        fetch('sec-breach.html').then(function(res) {
          console.log("Response inside main frame", res);
          res.text().then(function(res2) {
            console.log('Resolved text', res2);
          });
        });
      }
      
      function startWorker() {
        worker = new Worker("dedicatedWorker.js");
      }

      //navigator.serviceWorker.addEventListener('message', function(event) { logToHtml(event.data); });
      
      /*
      function postMessageToServiceWorker(registration) {
        if (registration.installing) {
           // If ServiceWorkerRegistration.installing is set, then this page isn't actively controlled
           // by a Service Worker, but one was just installed.
           registration.installing.postMessage({'message': 'Hello installing Service Worker'});
        } else if (navigator.serviceWorker.controller) {
           // If .controller is set, then this page is being actively controlled by the Service Worker.
           navigator.serviceWorker.controller.postMessage({'message': 'Hello active Service Worker'});
        }
      }

      function handleMessage(msg) {
        console.log(msg);
      }
      */
      
      
      
    </script>

  </body>
</html>
